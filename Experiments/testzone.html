<!doctype html>
<html>
  <head>
    <title>Test Area</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="jspsych-5.0.3/jspsych.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-survey-multi-choice.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-survey-likert.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-instructions.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-single-stim.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych-5.0.3/plugins/jspsych-html.js"></script>
    <link href="jspsych-5.0.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>
    <div id="jspsych-target"></div>
  </body>

  <script>
    var participant = jsPsych.randomization.randomID(8);


    //instructions
    var instructC = {
      type: 'instructions',
      pages: [
        "Now that you have completed all hypothetical deal questions, we'd like you to answer just a few more questions."
      ],
      show_clickable_nav: true
    };

    var gamingNodeId;
    var paymentNodeId;
    var gamer_mobile = {
      type: 'survey-multi-choice',
      questions: ["Do you play any mobile/social-network video games (e.g., Farmville, Candy Crush, Pokemon Go, Clash of Clans)?"],
      options: [["Yes","No"]],
      func: function(){
        gamingNodeId = jsPsych.currentTimelineNodeID()
      }
    };

    var game_freq = {
      type: 'survey-likert',
      questions: ["On average, how many hours a week do you play the these kinds of games?"],
      labels: [["Less than 1",	"1-4",	"5-9",	"10-19",	"20-29",	"30-39",	"40+"]]
    };

    var condition_game_freq = {
      timeline: [game_freq],
      conditional_function: function(){
        var data = jsPsych.data.getLastTrialData().responses;
        if(data.slice(7,data.length-2) == "Yes"){
            return true;
        } else {
            return false;
        }

      }
    };


    var gamer_payer = {
      type: 'survey-multi-choice',
      questions: ["When you play these games, do you ever spend your money on in-game payments?"],
      options: [["Yes","No"]],
      func: function(){
        paymentNodeId = jsPsych.currentTimelineNodeID()
      }
    };

    var condition_game_payer = {
      timeline: [gamer_payer],
      conditional_function: function(){
        var data = jsPsych.data.getDataByTimelineNode(gamingNodeId)[0].responses;
        if(data.slice(7,data.length-2) == "Yes"){
            return true;
        } else {
            return false;
        }

      }
    };

    var pay_amount = {
      type: 'survey-text',
      columns:[10],
      rows:[1],
      endtext:" in Dollars",
      questions: ["On average, how much money do you spend on mobile/social-network video games per month?"]
    }

    var condition_pay_amount = {
      timeline: [pay_amount],
      conditional_function: function(){
        var data = jsPsych.data.getDataByTimelineNode(paymentNodeId)[0].responses;
        if(data.slice(7,data.length-2) == "Yes"){
            return true;
        } else {
            return false;
        }

      }
    };

    var list_games = {
      type: 'survey-text',
      columns:[100],
      rows:[5],
      questions: ["Please provide a list of the games where you make or have made in-game payments."]
    }

    var condition_list_games = {
      timeline: [list_games],
      conditional_function: function(){
        var data = jsPsych.data.getDataByTimelineNode(paymentNodeId)[0].responses;
        if(data.slice(7,data.length-2) == "Yes"){
            return true;
        } else {
            return false;
        }

      }
    };
    function save_data(filename, filedata){
      $.ajax({
        type:'post',
        cache: false,
        url: 'datawrite.php', // this is the path to the above PHP script
        data: {filename: filename, filedata: filedata},
        success: function(redirect){
          window.location.replace("http://www.dcsmithresearch.com/Experiments.html");
        }
     });
   };

    // timeline node order
    var timeline = [];

    timeline.push(instructC);
    timeline.push(gamer_mobile);
    timeline.push(condition_game_freq);
    timeline.push(condition_game_payer);
    timeline.push(condition_pay_amount);
    timeline.push(condition_list_games);

    /* start the experiment */
    jsPsych.init({
      /*global  $*/
      display_element: $('#jspsych-target'),
      timeline: timeline,
      on_finish: function() {
        save_data(participant+"_data.JSON",jsPsych.data.dataAsJSON());
      }
    });




  </script>




</html>
